# .github/workflows/update-data.yml

name: Update Macro Data

on:
  schedule:
    - cron: '0 8 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-data-files:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'latest'

      # 3. R íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install R dependencies
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          # --- ğŸš€ğŸš€ğŸš€ ì´ ë¶€ë¶„ì˜ ë“¤ì—¬ì“°ê¸°ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤! ğŸš€ğŸš€ğŸš€ ---
          packages:
            any::tidyverse
            any::lubridate
            any::readr
            any::readxl    # For Shiller AND FINRA
            any::rvest    # For FINRA
            any::httr     # For FINRA
          # --- ğŸš€ğŸš€ğŸš€ ì—¬ê¸°ê¹Œì§€ ğŸš€ğŸš€ğŸš€ ---

      # --- 4. Shiller CAPE ì‹¤í–‰ ---
      - name: Run R script for Shiller CAPE
        run: Rscript update_cape.R 

      # --- 5. FINRA Margin Debt ì‹¤í–‰ (ì¶”ê°€) ---
      - name: Run R script for FINRA Margin Debt
        run: Rscript update_finra.R

      # --- 6. ë³€ê²½ëœ íŒŒì¼ ëª¨ë‘ ì»¤ë°‹ (ìˆ˜ì •) ---
      - name: Commit updated files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“ˆ Auto-update macro data (CAPE & FINRA)"
          # ì»¤ë°‹í•  íŒŒì¼ íŒ¨í„´ì— finra_margin.csv ì¶”ê°€
          file_pattern: shiller_cape.csv finra_margin.csv 
          commit_user_name: "GitHub Action Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Action Bot <actions@github.com>"
          
