name: Update Macro Data (Shiller CAPE Only)

on:
  schedule:
    - cron: '0 8 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-cape-file:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'latest'
      - name: Install R dependencies
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          packages:
            any::tidyverse
            any::lubridate
            any::readr
            any::readxl    # Shiller CAPEìš©
      - name: Run R script for Shiller CAPE
        run: Rscript update_cape.R 
      - name: Commit updated file (CAPE Only)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“ˆ Auto-update Shiller CAPE data"
          file_pattern: shiller_cape.csv # CAPE íŒŒì¼ë§Œ ì»¤ë°‹
          commit_user_name: "GitHub Action Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Action Bot <actions@github.com>"
